@page "/payment"
@inject IDialogService DialogService
@inject PaymentService PaymentService
@inject NavigationManager Navigation

<!-- Modern Page Header -->
<div class="page-header fade-in-down" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); margin-top: 0; padding-top: 80px;">
    <div class="page-header-content" style="max-width: 100%; padding: 0 16px;">
        <div class="fade-in-left delay-1">
            <MudText Typo="Typo.h5" Class="page-header-title">
                <MudIcon Icon="@Icons.Material.Filled.CreditCard" Style="vertical-align: middle; margin-right: 8px;" />
                Tahsilat
            </MudText>
            <MudText Typo="Typo.body2" Style="color: rgba(255,255,255,0.9);">
                Kredi kartı ile ödeme işlemleri
            </MudText>
        </div>
    </div>
</div>

@if (_loading)
{
    <div class="loading-container fade-in">
        <div class="loading-spinner"></div>
        <MudText Typo="Typo.body2" Class="loading-text">İşlem yapılıyor...</MudText>
    </div>
}

@if (_error)
{
    <div class="error-container fade-in-up">
        <MudIcon Icon="@Icons.Material.Filled.Error" Class="error-icon" />
        <div class="error-content">
            <div class="error-title">Hata Oluştu</div>
            <div class="error-message">@_errorMessage</div>
        </div>
    </div>
}

@if (!_loading)
{
<div class="modern-card fade-in-up delay-1" style="margin: 16px;">
    <MudCard Class="pa-4">
    <MudForm>
        <MudGrid>
            <MudItem xs="12" sm="6">
                <MudTextField Label="Cari Kodu"
                              @bind-Value="_cariKodu"
                              Variant="Variant.Outlined"
                              Required="true" />
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudTextField Label="Ödeme Şekli Kodu"
                              @bind-Value="_odemeSekliKodu"
                              Variant="Variant.Outlined"
                              Required="true" />
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudTextField Label="Tutar"
                              @bind-Value="_tutar"
                              Variant="Variant.Outlined"
                              Required="true"
                              InputType="InputType.Number" />
            </MudItem>
            <MudItem xs="12">
                <MudButton Variant="Variant.Filled"
                           Color="Color.Primary"
                           OnClick="ProcessPayment"
                           FullWidth="true">
                    Ödeme Yap
                </MudButton>
            </MudItem>
        </MudGrid>
    </MudForm>
</MudCard>
</div>
}

@code {
    private bool _loading = false;
    private bool _error = false;
    private string _errorMessage = string.Empty;
    private string _cariKodu = "";
    private string _odemeSekliKodu = "";
    private double _tutar = 0;

    private async Task ProcessPayment()
    {
        _loading = true;
        _error = false;
        StateHasChanged();

        try
        {
            var result = await PaymentService.AddPayment(_cariKodu, _odemeSekliKodu, _tutar);
            if (result == "OK")
            {
                await DialogService.ShowMessageBox("Başarılı", "Ödeme işlemi başarıyla tamamlandı.");
                Navigation.NavigateTo("/");
            }
            else
            {
                _error = true;
                _errorMessage = result;
            }
        }
        catch (Exception ex)
        {
            _error = true;
            _errorMessage = ex.Message;
        }
        finally
        {
            _loading = false;
            StateHasChanged();
        }
    }
}
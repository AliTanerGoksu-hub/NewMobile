@inject StockService StockService
@inject ISnackbar Snackbar
@inject IDialogService DialogService
@inject IJSRuntime JSRuntime

<MudTable Class="mx-2"
          Breakpoint="Breakpoint.None"
          Items="stockList" Dense="true"
          Hover="true"
          SortLabel="Sort By"
          RowsPerPage="25"
          Striped="true"
          Bordered="true"
          FixedHeader="true"
          FixedFooter="true"
           OnRowClick="@((TableRowClickEventArgs<Stock> args) => SelectStock(args))"
          Style="height:90vh;overflow-y:auto">
    <HeaderContent>
        <MudTh Style="display:none;"><MudTableSortLabel SortBy="new Func<Stock, object>(x=>x.nStokID)">Stok Id</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<Stock, object>(x=>x.sKodu)">Stok Kodu</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<Stock, object>(x=>x.sAciklama)">Stok Adı</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<Stock, object>(x=>x.lMevcut)">Mevcut</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<Stock, object>(x=>x.sBarkod)">Barkod</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<Stock, object>(x=>x.sBirimCinsi2)">Birim</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<Stock, object>(x=>x.sBirimCinsi2)">Birim 2</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<Stock, object>(x=>x.nBirimCarpan)">Koli İçi</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<Stock, object>(x=>x.lMevcut2)">Mevcut 2</MudTableSortLabel></MudTh>
        <MudTh><MudTableSortLabel SortBy="new Func<Stock, object>(x=>x.lFiyat1)">Fiyat</MudTableSortLabel></MudTh>
        @if (sizeOpen == "1")
        {
            <MudTh><MudTableSortLabel SortBy="new Func<Stock, object>(x=>x.sBeden)">Beden</MudTableSortLabel></MudTh>
        }
        @if (colorOpen == "1")
        {
            <MudTh><MudTableSortLabel SortBy="new Func<Stock, object>(x=>x.sRenkAdi)">Renk</MudTableSortLabel></MudTh>
        }
    </HeaderContent>
    <RowTemplate>

        <MudTd Style="display:none;" DataLabel="Stok ID">@context.nStokID</MudTd>
        <MudTd DataLabel="Stok Kodu">@context.sKodu</MudTd>
        <MudTd DataLabel="Stok Adı">@context.sAciklama</MudTd>
        <MudTd DataLabel="Mevcut">@context.lMevcut</MudTd>
        <MudTd DataLabel="Barkod">@context.sBarkod</MudTd>
        <MudTd DataLabel="Birim">@context.sBirimCinsi2</MudTd>
        <MudTd DataLabel="Birim 2">@context.sBirimCinsi2</MudTd>
        <MudTd DataLabel="Koli İçi">@context.nBirimCarpan</MudTd>
        <MudTd DataLabel="Mevcut 2">@context.lMevcut2</MudTd>
        @*<MudTd DataLabel="Fiyat">@((double.Parse(context.lFiyat, System.Globalization.CultureInfo.InvariantCulture)).ToString("F2", System.Globalization.CultureInfo.InvariantCulture)) </MudTd>*@
        <MudTd DataLabel="Fiyat">@context.lFiyat1 </MudTd>
        @if (sizeOpen == "1")
        {
            <MudTd DataLabel="Beden">@context.sBeden</MudTd>
        }
        @if (colorOpen == "1")
        {
            <MudTd DataLabel="Renk">@context.sRenkAdi</MudTd>
        }
    </RowTemplate>
    <PagerContent>
        <MudTablePager RowsPerPageString="Gösterilecek Satır" />
    </PagerContent>
</MudTable>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }
    [Parameter] public List<Stock> stockList { get; set; } = new();
    //private IEnumerable<TbFirma> Elements = Enumerable.Empty<TbFirma>();
    private string apiMessage = string.Empty;
    private static string colorOpen = CommonParameters.colorOpen;
    private static string sizeOpen = CommonParameters.sizeOpen;
    private Stock selectedStock = new Stock();
    private bool _loading = true;
    private bool _error = false;
    private string _errorMessage = "";

    private async Task SelectStock(TableRowClickEventArgs<Stock> args)
    {
        var item = args.Item;
        MudDialog.Close(DialogResult.Ok(item));
    }


}